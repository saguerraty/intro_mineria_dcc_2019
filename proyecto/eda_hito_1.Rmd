---
title: "Informe hito 1"
author: '@saguerraty @BastyZ @AnnBenavides'
date: "August 25, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#cargar paquetes
library(readr)
library(ggplot2)
library(stats)
library(purrr)
library(tidyr)
library(psych)
library(corrplot)
library(gridExtra)
```

## Introducción

En este proyecto de minería de datos analizaremos información diaria de mediciones de calidad del aire en Parque O'Higgins así como temperaturas y precipitaciones en Quinta Normal. Estas mediciones fueron realizadas respectivamente por SINCA del Ministerio del Medio Ambiente y el CR^2 (Center for Climate and Resilience Research) e incluyen datos obtenidos desde 1997 hasta la fecha en ambas estaciones.

Inicialmente se busca utilizar estos datos para buscar correlacion entre la calidad del aire y temperatura/precipitaciones, buscar patrones estacionales en el estado del aire para analizar su evolución a traves de los años, y buscar ver la influencia de leyes y restricciones ambientales como la restricción vehicular a cataliticos anteriores a 2012.

## Descripción de datos y exploración
Se extrajeron datos de del Sistema de Información Nacional de Calidad del Aire(SINCA) y Center for Climate an Resilence Research (CR2), para mediciones diarias de la calidad del aire e historial climático respectivamente.

### SINCA: Estación de Parque O'higgins
A través del SINCA se obtiene la información histórica de la siguientes emiciones:
- Material particulado (MP10 y MP2.5) desde el 2000-01-01 hasta hoy (2019-08-25)
- Monóxido de carbono (CO) desde 1997-04-08 hasta hoy
- Ozono (O3) desde 1997-04-02 hasta hoy
- Dióxido de azufre (SO2) desde 1997-07-19 hasta 2017-01-08
- Dióxido de nitrógeno (NO2) desde 2009-03-26 hasta hoy

### CR2: Foco Quinta Normal
Se obtiene información histórica diaria de la temperatura media (°C), temperatura máxima(°C) y precipitaciones(mm) en la estación de medición de Quinta Normal (la mas cercana a Parque O'higgins) desde 1950 a la fecha.

## Manejo y exploración de datos
Se relacionan todos los datos anteriores respecto a las fechas, para su manejo más afable. Recordemos que no todas la mediciones tienen la misma cantidad de historial, siendo el rango 2009-2017 el más completo. 
```{r echo=FALSE, message=FALSE}
#lectura de datos
datos=read.csv("./ClimaYEmisionesData/DatosHito1Clean.csv",sep=",")
datos$date=paste0(datos$dia,'/',datos$mes,'/',datos$anno)
datos$date<-as.POSIXlt(datos$date, format = "%d/%m/%Y")
```
En particular, dioxido de azufre no están disponibles para el total del tiempo para el que se tiene registro en las mediciones (1997 - 2019). Debido a que no se cuenta con información adecuada para interpolar estos datos no se incorporarán.
```{r}
datos<-subset(datos,select = -c(MP25,NO2))
multi.hist(datos[,c(5:11)])
correlaciones=cor(datos[,c(5:11)], use = "complete.obs")
corrplot.mixed(correlaciones,upper = "circle" )
```

<!-- # TODO: promedios mensuales y comparación anual de dichos meses (ej. Abril 97-19) -->

### Tendencias mensuales
Para evaluar de manera rápida la evolución de las métricas a través de los años, se genera una aggregación por año y mes y se grafican para observar los cambios y patrones más notorios:
```{r}
data_monthly<-subset(datos, select= -c(1,4,12))
monthly_data<-aggregate(data_monthly[3:9], by=list(anno=data_monthly$anno, mes=data_monthly$mes), FUN = mean)

```
- *Enero*
```{r, message=FALSE}
#ggplot((with(monthly_data,monthly_data[mes==1,]), aes(anno, O3))+geom_point(mapping=aes(anno, O3))
#plotting Enero
ozonoene <- ggplot(with(monthly_data,monthly_data[mes==1,]),aes(anno, O3)) + 
    geom_bar(stat="identity") + theme_minimal() +
    ggtitle("Tendencia de Ozono en Enero") +
    xlab("Años") + ylab("O3 (ppb)")

mp10ene <-ggplot(with(monthly_data,monthly_data[mes ==1,]),aes(x=anno, y=MP10)) + 
    geom_bar(stat="identity") + theme_minimal() +
    ggtitle("Tendencia de MP10 en Enero") +
    xlab("Años") + ylab("Material Particulado (µg∕m3)")

coene <- ggplot(with(monthly_data,monthly_data[mes==1,]),aes(x=anno, y=CO)) + 
    geom_bar(stat="identity") + theme_minimal() +
    ggtitle("Tendencia de CO en Enero") +
    xlab("Años") + ylab("CO (ppm)")

soene <- ggplot(with(monthly_data,monthly_data[mes==1,]),aes(x=anno, y=SO2)) + 
    geom_bar(stat="identity") + theme_minimal() +
    ggtitle("Tendencia de SO2 en Enero") +
    xlab("Años") + ylab("SO2 (µg∕m3)")

tmene <- ggplot(with(monthly_data,monthly_data[mes ==1,]),aes(x=anno, y=Tmedia)) + 
    geom_bar(stat="identity") + theme_minimal() +
    ggtitle("Tendencia de temperatura media en Enero") +
    xlab("Años") + ylab("T° (°C)")

tmaxene <- ggplot(with(monthly_data,monthly_data[mes ==1,]),aes(x=anno, y=Tmax)) + 
    geom_bar(stat="identity") + theme_minimal() +
    ggtitle("Tendencia de temperatura máxima en Enero") +
    xlab("Años") + ylab("T° (°C)")

lluviaene <- ggplot(with(monthly_data,monthly_data[mes ==1,]),aes(x=anno, y=Precipitaciones)) + 
    geom_bar(stat="identity") + theme_minimal() +
    ggtitle("Tendencia de Precipitaciones en Enero") +
    xlab("Años") + ylab("Precipitaciones (mm)")


grid.arrange(tmene, tmaxene, lluviaene, nrow=2)
grid.arrange(ozonoene, mp10ene, coene, soene, ncol=2)
```
<!-- - *Febrero* -->
<!-- ```{r} -->
<!-- ggplot(with(monthly_data,monthly_data[mes==2,]),aes(x=anno, y=O3)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Ozono en Febrero") + -->
<!--     xlab("Años") + ylab("O3 (ppb)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==2,]),aes(x=anno, y=MP10)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de MP10 en Febrero") + -->
<!--     xlab("Años") + ylab("Material Particulado (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==2,]),aes(x=anno, y=CO)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de CO en Febrero") + -->
<!--     xlab("Años") + ylab("CO (ppm)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==2,]),aes(x=anno, y=SO2)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de SO2 en Febrero") + -->
<!--     xlab("Años") + ylab("SO2 (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==2,]),aes(x=anno, y=Tmedia)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura media en Febrero") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==2,]),aes(x=anno, y=Tmax)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura máxima en Febrero") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==2,]),aes(x=anno, y=Precipitaciones)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Precipitaciones en Febrero") + -->
<!--     xlab("Años") + ylab("Precipitaciones (mm)") -->
<!-- ``` -->
<!-- - *Marzo* -->
<!-- ```{r} -->
<!-- ggplot(with(monthly_data,monthly_data[mes==3,]),aes(x=anno, y=O3)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Ozono en Marzo") + -->
<!--     xlab("Años") + ylab("O3 (ppb)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==3,]),aes(x=anno, y=MP10)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de MP10 en Marzo") + -->
<!--     xlab("Años") + ylab("Material Particulado (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==3,]),aes(x=anno, y=CO)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de CO en Marzo") + -->
<!--     xlab("Años") + ylab("CO (ppm)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==3,]),aes(x=anno, y=SO2)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de SO2 en Marzo") + -->
<!--     xlab("Años") + ylab("SO2 (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==3,]),aes(x=anno, y=Tmedia)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura media en Marzo") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==3,]),aes(x=anno, y=Tmax)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura máxima en Marzo") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==3,]),aes(x=anno, y=Precipitaciones)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Precipitaciones en Marzo") + -->
<!--     xlab("Años") + ylab("Precipitaciones (mm)") -->
<!-- ``` -->
<!-- - *Abril* -->
<!-- ```{r} -->
<!-- ggplot(with(monthly_data,monthly_data[mes==4,]),aes(x=anno, y=O3)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Ozono en Abril") + -->
<!--     xlab("Años") + ylab("O3 (ppb)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==4,]),aes(x=anno, y=MP10)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de MP10 en Abril") + -->
<!--     xlab("Años") + ylab("Material Particulado (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==4,]),aes(x=anno, y=CO)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de CO en Abril") + -->
<!--     xlab("Años") + ylab("CO (ppm)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==4,]),aes(x=anno, y=SO2)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de SO2 en Abril") + -->
<!--     xlab("Años") + ylab("SO2 (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==4,]),aes(x=anno, y=Tmedia)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura media en Abril") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==4,]),aes(x=anno, y=Tmax)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura máxima en Abril") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==4,]),aes(x=anno, y=Precipitaciones)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Precipitaciones en Abril") + -->
<!--     xlab("Años") + ylab("Precipitaciones (mm)") -->
<!-- ``` -->
<!-- - *Mayo* -->
<!-- ```{r} -->
<!-- ggplot(with(monthly_data,monthly_data[mes==5,]),aes(x=anno, y=O3)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Ozono en Mayo") + -->
<!--     xlab("Años") + ylab("O3 (ppb)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==5,]),aes(x=anno, y=MP10)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de MP10 en Mayo") + -->
<!--     xlab("Años") + ylab("Material Particulado (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==5,]),aes(x=anno, y=CO)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de CO en Mayo") + -->
<!--     xlab("Años") + ylab("CO (ppm)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==5,]),aes(x=anno, y=SO2)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de SO2 en Mayo") + -->
<!--     xlab("Años") + ylab("SO2 (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==5,]),aes(x=anno, y=Tmedia)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura media en Mayo") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==5,]),aes(x=anno, y=Tmax)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura máxima en Mayo") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==5,]),aes(x=anno, y=Precipitaciones)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Precipitaciones en Mayo") + -->
<!--     xlab("Años") + ylab("Precipitaciones (mm)") -->
<!-- ``` -->
<!-- - *Junio* -->
<!-- ```{r} -->
<!-- ggplot(with(monthly_data,monthly_data[mes==6,]),aes(x=anno, y=O3)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Ozono en Junio") + -->
<!--     xlab("Años") + ylab("O3 (ppb)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==6,]),aes(x=anno, y=MP10)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de MP10 en Junio") + -->
<!--     xlab("Años") + ylab("Material Particulado (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==6,]),aes(x=anno, y=CO)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de CO en Junio") + -->
<!--     xlab("Años") + ylab("CO (ppm)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==6,]),aes(x=anno, y=SO2)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de SO2 en Junio") + -->
<!--     xlab("Años") + ylab("SO2 (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==6,]),aes(x=anno, y=Tmedia)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura media en Junio") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==6,]),aes(x=anno, y=Tmax)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura máxima en Junio") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==6,]),aes(x=anno, y=Precipitaciones)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Precipitaciones en Junio") + -->
<!--     xlab("Años") + ylab("Precipitaciones (mm)") -->
<!-- ``` -->
<!-- - *Julio* -->
<!-- ```{r} -->
<!-- ggplot(with(monthly_data,monthly_data[mes==7,]),aes(x=anno, y=O3)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Ozono en Julio") + -->
<!--     xlab("Años") + ylab("O3 (ppb)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==7,]),aes(x=anno, y=MP10)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de MP10 en Julio") + -->
<!--     xlab("Años") + ylab("Material Particulado (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==7,]),aes(x=anno, y=CO)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de CO en Julio") + -->
<!--     xlab("Años") + ylab("CO (ppm)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==7,]),aes(x=anno, y=SO2)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de SO2 en Julio") + -->
<!--     xlab("Años") + ylab("SO2 (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==7,]),aes(x=anno, y=Tmedia)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura media en Julio") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==7,]),aes(x=anno, y=Tmax)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura máxima en Julio") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==7,]),aes(x=anno, y=Precipitaciones)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Precipitaciones en Julio") + -->
<!--     xlab("Años") + ylab("Precipitaciones (mm)") -->
<!-- ``` -->
<!-- - *Agosto* -->
<!-- ```{r} -->
<!-- ggplot(with(monthly_data,monthly_data[mes==8,]),aes(x=anno, y=O3)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Ozono en Agosto") + -->
<!--     xlab("Años") + ylab("O3 (ppb)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==8,]),aes(x=anno, y=MP10)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de MP10 en Agosto") + -->
<!--     xlab("Años") + ylab("Material Particulado (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==8,]),aes(x=anno, y=CO)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de CO en Agosto") + -->
<!--     xlab("Años") + ylab("CO (ppm)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes==8,]),aes(x=anno, y=SO2)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de SO2 en Agosto") + -->
<!--     xlab("Años") + ylab("SO2 (µg∕m3)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==8,]),aes(x=anno, y=Tmedia)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura media en Agosto") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==8,]),aes(x=anno, y=Tmax)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de temperatura máxima en Agosto") + -->
<!--     xlab("Años") + ylab("T° (°C)") -->

<!-- ggplot(with(monthly_data,monthly_data[mes ==8,]),aes(x=anno, y=Precipitaciones)) +  -->
<!--     geom_bar(stat="identity") + theme_minimal() + -->
<!--     ggtitle("Tendencia de Precipitaciones en Agosto") + -->
<!--     xlab("Años") + ylab("Precipitaciones (mm)") -->

<!-- ``` -->
<!-- - *Septiembre* -->
<!-- - *Octubre* -->
<!-- - *Noviembre* -->
<!-- - *Diciembre* -->
<!-- # TODO: variación respecto a dia en año anterior (ej. abril 98-06-10 - abril 97-06-10 ) -->
```{r}
#TODO
```

## Hipótesis
Inicialmente nos planteamos las siguientes hipótesis o dudas, las cuales intentaremos responder durante la exploración y análisis de los datos

- Existe una correlación entre la calidad del aire y las condiciones climáticas (temperatura/precipitaciones).
- Existen patrones estacionales en las condiciones del aire, y han evolucionado con los años.
- Existe influencia real de las leyes y restricciones en la calidad del aire en Santiago.
- Existe una relación entre temperaturas máximas y mediciones de Ozono.

Nuestra idea es analizar los histogramas y series de tiempo para entender como se distribuyen los datos para luego cruzarlos y buscar correlaciones que apoyen o refuten nuestras hipotesis. Además en el caso de los patrones pensamos analizar la variaciones de cada medida durante los años respecto al año anterior, tanto de forma agregada como variación diaria/mensual.



